# 交流平台项目教学
## 第一步 [创建目录]
## 第二步 [打开终端]
```bash
#  创建项目于当前目录
    npm create vite@latest ./

```
```javascript
/*选择React
* ? Select a framework: » - Use arrow-keys. Return to submit.
    Vanilla
    Vue
>   React
    Preact
    Lit
    Svelte
    Solid
    Qwik
    Others
* */
/*选择typescript
* ? Select a variant: » - Use arrow-keys. Return to submit.
>   TypeScript
    TypeScript + SWC
    JavaScript
    JavaScript + SWC
    Remix ↗
* */
```
```bash
# 继续输入npm install 进行补包
 npm install
# 补包完成之后启动项目 
 npm run dev
 
# ctrl + c关闭当前项目

```

### 第三步 [删除src目录下所有文件]
## <a name="snippets">🕸️ 片段</a>
<details>
<summary><code>App.tsx</code></summary>

```typescript jsx
const App = () => {
    return (
        <h1>
            Hello world!
        </h1>
    )
}

export default App

```
</details>

<details>
<summary><code>main.tsx</code></summary>

```typescript jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)


```

</details>

<details>
<summary><code>vite-env.d.ts</code></summary>

```typescript
/// <reference types="vite/client" />

```

</details>

### 第四步 [安装tailwindcss框架]
```bash
#   终端输入
npm install -D tailwindcss postcss autoprefixer
# 初始化
npx tailwindcss init -p
# 安装ts模块
 npm install -D @types/tailwindcss
```
## 第五步 [配置tailwindcss]

# 安装 shadcn/ui框架
# 选择vite
```bash
# 依次输入
npm install -D tailwindcss postcss autoprefixer

npx tailwindcss init -p


```
# 配置内容

<details>
<summary><code>tsconfig.json</code></summary>

```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}


```


</details>

<details>
<summary><code>tsconfig.app.json</code></summary>

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./src/*"
      ]
    },
    
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",


    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}



```


</details>

<details>
<summary><code>vite.config.ts</code></summary>

```bash
# 终端输入
# (确保解析不失误)
npm i -D @types/node

```


```typescript 

import path from "path"
import react from "@vitejs/plugin-react"
import { defineConfig } from "vite"

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
})



```


</details>


# <a href="https://ui.shadcn.com/">shadcn/ui框架地址</a>



# <a>🕸️ 片段</a>

<details>
<summary><code>tailwind.config.js</code></summary>

```javascript
/** @type {import('tailwindcss').Config} */
export default {
    content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
    ],
    theme: {
        extend: {},
    },
    plugins: [],
}



```

</details>

<details>
<summary><code>globals.css</code></summary>

```css
@tailwind base;
@tailwind components;
@tailwind utilities;




```

</details>

# 安装ui

```bash
npx shadcn@latest init

```
# 配置components.json
```md

Which style would you like to use? › New York
Which color would you like to use as base color? › Zinc
Do you want to use CSS variables for colors? › no / yes

```
# 添加组件

```bash
# 
npx shadcn@latest add button

```
# ui组件使用

```typescript jsx

import { Button } from "@/components/ui/button"

export default function Home() {
  return (
    <div>
      <Button>Click me</Button>
    </div>
  )
}

```

# 自定义主题tailwindcss配置

<details>
<summary><code>tailwindcss.config.js</code></summary>

```js
/** @type {import('tailwindcss').Config} */
const defaultTheme = require('tailwindcss/defaultTheme')

module.exports = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: '2rem',
      screens: {
        '2xl': '1400px',

      },
    },
    extend: {
      colors: {
        'primary-500': '#877EFF',
        'primary-600': '#5D5FEF',
        'secondary-500': '#FFB620',
        'off-white': '#D0DFFF',
        'red': '#FF5A5A',
        'dark-1': '#000000',
        'dark-2': '#09090A',
        'dark-3': '#101012',
        'dark-4': '#1F1F22',
        'light-1': '#FFFFFF',
        'light-2': '#EFEFEF',
        'light-3': '#7878A3',
        'light-4': '#5C5C7B',
      },
      screens: {
        'xs': '480px',

      },
      width: {
        '420': '420px',
        '465': '465px',
      },
      fontFamily: {
        inter: ['Inter', 'sans-serif'],

      },
      keyframes: {
        'accordion-down': {
          from: { height: 0 },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: 0 },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
      },
    },
  },
  plugins: [require('tailwindcss-animate')],
};
```
</details>

<details>
<summary><code>globals.css</code></summary>

```css
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply box-border list-none p-0 m-0 scroll-smooth;
  }

  body {
    @apply bg-dark-1 text-white min-h-screen font-inter;
  }
}

@layer utilities {
  /* TYPOGRAPHY */
  .h1-bold {
    @apply text-[36px] font-bold leading-[140%] tracking-tighter;
  }

  .h1-semibold {
    @apply text-[36px] font-semibold leading-[140%] tracking-tighter;
  }

  .h2-bold {
    @apply text-[30px] font-bold leading-[140%] tracking-tighter;
  }

  .h3-bold {
    @apply text-[24px] font-bold leading-[140%] tracking-tighter;
  }

  .base-semibold {
    @apply text-[16px] font-semibold leading-[140%] tracking-tighter;
  }

  .base-medium {
    @apply text-[16px] font-medium leading-[140%];
  }

  .base-regular {
    @apply text-[16px] font-normal leading-[140%];
  }

  .body-bold {
    @apply text-[18px] font-bold leading-[140%];
  }

  .body-medium {
    @apply text-[18px] font-medium leading-[140%];
  }

  .small-semibold {
    @apply text-[14px] font-semibold leading-[140%] tracking-tighter;
  }

  .small-medium {
    @apply text-[14px] font-medium leading-[140%];
  }

  .small-regular {
    @apply text-[14px] font-normal leading-[140%];
  }

  .subtle-semibold {
    @apply text-[12px] font-semibold leading-[140%];
  }

  .tiny-medium {
    @apply text-[10px] font-medium leading-[140%];
  }

  /* UTILITIES */
  .invert-white {
    @apply invert brightness-0 transition;
  }

  .flex-center {
    @apply flex justify-center items-center;
  }

  .flex-between {
    @apply flex justify-between items-center;
  }

  .flex-start {
    @apply flex justify-start items-center;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 3px;
    height: 3px;
    border-radius: 2px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: #09090a;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #5c5c7b;
    border-radius: 50px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #7878a3;
  }

  .common-container {
    @apply flex flex-col flex-1 items-center gap-10 overflow-scroll py-10 px-5 md:px-8 lg:p-14 custom-scrollbar;
  }

  /* All Users */
  .user-container {
    @apply max-w-5xl flex flex-col items-start w-full gap-6 md:gap-9;
  }

  .user-grid {
    @apply w-full grid grid-cols-1 xs:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-7 max-w-5xl;
  }

  /* Explore */
  .explore-container {
    @apply flex flex-col flex-1 items-center overflow-scroll py-10 px-5 md:p-14 custom-scrollbar;
  }

  .explore-inner_container {
    @apply max-w-5xl flex flex-col items-center w-full gap-6 md:gap-9;
  }

  .explore-search {
    @apply h-12 bg-dark-4 border-none placeholder:text-light-4 focus-visible:ring-0 focus-visible:ring-offset-0 ring-offset-0 !important;
  }

  /* Home */
  .home-container {
    @apply flex flex-col flex-1 items-center gap-10 overflow-scroll py-10 px-5 md:px-8 lg:p-14 custom-scrollbar;
  }

  .home-posts {
    @apply max-w-screen-sm flex flex-col items-center w-full gap-6 md:gap-9;
  }

  .home-creators {
    @apply hidden xl:flex flex-col w-72 2xl:w-465 px-6 py-10 gap-10  overflow-scroll custom-scrollbar;
  }

  /* Post Details */
  .post_details-container {
    @apply flex flex-col flex-1 gap-10 overflow-scroll py-10 px-5 md:p-14 custom-scrollbar items-center;
  }

  .post_details-card {
    @apply bg-dark-2 w-full max-w-5xl rounded-[30px] flex-col flex xl:flex-row border border-dark-4 xl:rounded-l-[24px];
  }

  .post_details-img {
    @apply h-80 lg:h-[480px] xl:w-[48%] rounded-t-[30px] xl:rounded-l-[24px] xl:rounded-tr-none object-cover p-5 bg-dark-1;
  }

  .post_details-info {
    @apply bg-dark-2 flex flex-col gap-5 lg:gap-7 flex-1 items-start p-8 rounded-[30px];
  }

  .post_details-delete_btn {
    @apply p-0 flex gap-3 hover:bg-transparent hover:text-light-1  text-light-1 small-medium lg:base-medium;
  }

  /* Profile */
  .profile-container {
    @apply flex flex-col items-center flex-1 gap-10 overflow-scroll py-10 px-5 md:p-14 custom-scrollbar;
  }

  .profile-inner_container {
    @apply flex items-center md:mb-8 xl:items-start gap-8 flex-col xl:flex-row relative max-w-5xl w-full;
  }

  .profile-tab {
    @apply flex-center gap-3 py-4 w-48 bg-dark-2  transition flex-1 xl:flex-initial;
  }

  /* Saved */
  .saved-container {
    @apply flex flex-col flex-1 items-center gap-10 overflow-scroll py-10 px-5 md:p-14 custom-scrollbar;
  }

  /* Bottom bar */
  .bottom-bar {
    @apply z-50 flex-between w-full sticky bottom-0 rounded-t-[20px] bg-dark-2 px-5 py-4 md:hidden;
  }

  /* File uploader */
  .file_uploader-img {
    @apply h-80 lg:h-[480px] w-full rounded-[24px] object-cover object-top;
  }

  .file_uploader-label {
    @apply text-light-4 text-center small-regular w-full p-4 border-t border-t-dark-4;
  }

  .file_uploader-box {
    @apply flex-center flex-col p-7 h-80 lg:h-[612px];
  }

  /* Grid Post List */
  .grid-container {
    @apply w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-7 max-w-5xl;
  }

  .grid-post_link {
    @apply flex rounded-[24px] border border-dark-4 overflow-hidden cursor-pointer w-full h-full;
  }

  .grid-post_user {
    @apply absolute bottom-0 p-5 flex-between w-full bg-gradient-to-t from-dark-3 to-transparent rounded-b-[24px] gap-2;
  }

  /* Left sidebar */
  .leftsidebar {
    @apply hidden md:flex px-6 py-10 flex-col justify-between min-w-[270px] bg-dark-2;
  }

  .leftsidebar-link {
    @apply rounded-lg base-medium hover:bg-primary-500 transition;
  }

  /* Post Card */
  .post-card {
    @apply bg-dark-2 rounded-3xl border border-dark-4 p-5 lg:p-7 w-full max-w-screen-sm;
  }

  .post-card_img {
    @apply h-64 xs:h-[400px] lg:h-[450px] w-full rounded-[24px] object-cover mb-5;
  }

  /* Topbar */
  .topbar {
    @apply sticky top-0 z-50 md:hidden bg-dark-2 w-full;
  }

  /* User card */
  .user-card {
    @apply flex-center flex-col gap-4 border border-dark-4 rounded-[20px] px-5 py-8;
  }
}

@layer components {
  /* SHADCN COMPONENTS */
  /* Form */
  .shad-form_label {
    @apply text-white !important;
  }

  .shad-form_message {
    @apply text-red !important;
  }

  .shad-input {
    @apply h-12 bg-dark-4 border-none placeholder:text-light-4 focus-visible:ring-1 focus-visible:ring-offset-1 ring-offset-light-3 !important;
  }

  .shad-textarea {
    @apply h-36 bg-dark-3 rounded-xl border-none focus-visible:ring-1 focus-visible:ring-offset-1 ring-offset-light-3 !important;
  }

  /* Button */
  .shad-button_primary {
    @apply bg-primary-500 hover:bg-primary-500 text-light-1 flex gap-2 !important;
  }

  .shad-button_dark_4 {
    @apply h-12 bg-dark-4 px-5 text-light-1 flex gap-2 !important;
  }

  .shad-button_ghost {
    @apply flex gap-4 items-center justify-start hover:bg-transparent hover:text-white !important;
  }
}

```

</details>

```bash
# 安装React-router-dom

 npm install react-router-dom
 
```

# main.tsx配置

<details>
<summary><code>main.tsx</code></summary>

```typescript jsx
import ReactDOM from "react-dom/client";
import App from './App.tsx'
import './globals.css'
import {BrowserRouter} from "react-router-dom";

ReactDOM.createRoot(document.getElementById('root')!).render(
    <BrowserRouter>
        <App/>
    </BrowserRouter>
)

```

</details>

# 创建路由以及配套组件

<details>
<summary><code>App.tsx</code></summary>

```typescript jsx
import {Route, Routes} from 'react-router-dom'
import Home from '@/_root/pages/Home'
import AuthLayout from "@/_auth/AuthLayout.tsx";
import SigninFrom from "@/_auth/forms/SigninFrom.tsx";
import SignupFrom from "@/_auth/forms/SignupFrom.tsx";
import RootLayout from "@/_root/RootLayout.tsx";
import AllUsers from "@/_root/pages/AllUsers";
import Explore from "@/_root/pages/Explore";
import Saved from "@/_root/pages/Saved";
import CreatePost from "@/_root/pages/CreatePost";
import EditPost from "@/_root/pages/EditPost";
import PostDetails from "@/_root/pages/PostDetails";
import Profile from "@/_root/pages/Profile";
import UpdateProfile from "@/_root/pages/UpdateProfile";

const App = () => {
    return (
        <>
            {/*响应式整个屏幕占比宽度*/}
            <main className="flex h-screen">
                <Routes>
                    {/*登录注册*/}
                    <Route element={<AuthLayout />}>
                        <Route path="/sign-in" element={<SigninFrom />}/>
                        <Route path="/sign-up" element={<SignupFrom />}/>
                    </Route>

                    {/*页面左侧导航栏*/}
                    <Route element={<RootLayout />}>
                        <Route index element={<Home />} />
                        <Route path="/explore" element={<Explore />} />
                        <Route path="/saved" element={<Saved />} />
                        <Route path="/all-users" element={<AllUsers />} />
                        <Route path="/create-post" element={<CreatePost />} />
                        <Route path="/update-post/:id" element={<EditPost />} />
                        <Route path="/posts/:id" element={<PostDetails />} />
                        <Route path="/profile/:id/*" element={<Profile />} />
                        <Route path="/update-profile/:id" element={<UpdateProfile />} />
                    </Route>
                </Routes>
            </main>
        </>
    )
}

export default App


```

</details>

<details>
<summary><code>AuthLayout.tsx</code></summary>

```typescript jsx
    import {Navigate, Outlet} from "react-router-dom";

const AuthLayout = () => {
    const isAuthenticated = false //验证是否登录
    return (
        <>
            {isAuthenticated ? (
                <Navigate to="/" /> //登录传送首页
            ):(
                <>
                    <section className="flex flex-1 justify-center items-center flex-col py-10">
                        <Outlet/> {/*内组件放在*/}
                    </section>

                    <img
                        src="/assets/images/side-img.svg"
                        alt="logo"
                        className="hidden xl:block h-screen w-1/2 object-cover bg-no-repeat"
                    />
                </>
            )}
        </>
    )
}

export default AuthLayout
```
</details>

# 登录
```bash
# npx shadcn@latest add from and input
npx shadcn@latest add from
npx shadcn@latest add input
```
# 步骤1
<details>
<summary><code>SigninFrom.tsx</code></summary>

```typescript jsx
import { z } from "zod"

import { zodResolver } from "@hookform/resolvers/zod"
import { useForm } from "react-hook-form"
import { Button } from "@/components/ui/button"
import {
    Form,
    FormControl,
    FormField,
    FormItem,
    FormLabel,
    FormMessage,
} from "@/components/ui/form"
import { Input } from "@/components/ui/input"

const SigninFrom = () => {

    const formSchema = z.object({
        email: z.string().email(),
        password: z.string().min(8, { message: "Password must be at least 8 characters." }),
    })

    // 1. Define your form.
    const form = useForm<z.infer<typeof formSchema>>({
        resolver: zodResolver(formSchema),
        defaultValues: {
            email: "",
            password: "",
        },
    })

    // 2. Define a submit handler.
    function onSubmit(values: z.infer<typeof formSchema>) {
        // Do something with the form values.
        // ✅ This will be type-safe and validated.
        console.log(values)
    }

    return (
        <Form {...form}>
            <div className="sm:w-420 flex-center flex-col">
                <img src="/assets/images/logo.svg" alt="logo"/>
                <h2 className="h3-bold md:h2-bold pt-5 sm:pt-12">
                    登录你的账户
                </h2>
                <p className="text-light-3 small-medium md:base-regular mt-2">
                    欢迎你，请登录你的账户以继续使用我们的服务。
                </p>
                <form onSubmit={form.handleSubmit(onSubmit)} className="flex flex-col gap-5 w-full mt-4">
                    <FormField
                        control={form.control}
                        name="email"
                        render={({field}) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">邮箱账户</FormLabel>
                                <FormControl>
                                    <Input type="text" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <FormField
                        control={form.control}
                        name="password"
                        render={({ field }) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">密码</FormLabel>
                                <FormControl>
                                    <Input type="password" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <Button type="submit">Submit</Button>
                </form>
            </div>
        </Form>
    )
}

export default SigninFrom

```

</details>

# 定义加载组件[components-创建shared目录]

<details>
<summary><code>loader.tsx</code></summary>


```typescript jsx
const Loader = () => {
    return (
        <div className="flex-center w-full">
            <img src="/assets/icons/loader.svg" alt="loader" width={24} height={24}/>
        </div>
    )
}

export default Loader

```
</details>

# 创建后端链接配置[具体操作 https://cloud.appwrite.io/v1]
# 创建ts声明 [创建types文件夹]

<details>
<summary><code>index.ts</code></summary>

```ts
export type INavLink = {
    imgURL: string;
    route: string;
    label: string;
};

export type IUpdateUser = {
    userId: string;
    name: string;
    bio: string;
    imageId: string;
    imageUrl: URL | string;
    file: File[];
};

export type INewPost = {
    userId: string;
    caption: string;
    file: File[];
    location?: string;
    tags?: string;
};

export type IUpdatePost = {
    postId: string;
    caption: string;
    imageId: string;
    imageUrl: URL;
    file: File[];
    location?: string;
    tags?: string;
};

export type IUser = {
    id: string;
    name: string;
    username: string;
    email: string;
    imageUrl: string;
    bio: string;
};

export type INewUser = {
    name: string;
    email: string;
    username: string;
    password: string;
};
```
</details>

### 前端配置
# lib文件夹[创建appwrite文件夹]
# 配置

<details>
<summary><code>config.ts</code></summary>

```ts
import { Client,Account,Databases,Storage,Avatars } from "appwrite";

export const appwriteConfig = {
    /*后端数据访问地址*/
    url: import.meta.env.VITE_APPWRITE_URL,
    /*后端项目ID*/
    projectId: import.meta.env.VITE_APPWRITE_PROJECT_ID,
    /*后端数据库ID*/
    databaseId: import.meta.env.VITE_APPWRITE_DATABASE_ID,
    /*后端存储库ID*/
    storageId: import.meta.env.VITE_APPWRITE_STORAGE_ID,
    /*用户数据集合ID*/
    userCollectionId: import.meta.env.VITE_APPWRITE_USER_COLLECTION_ID,
    /*用户发布帖子集合ID*/
    postCollectionId: import.meta.env.VITE_APPWRITE_POST_COLLECTION_ID,
    /*用户保存集合ID*/
    savesCollectionId: import.meta.env.VITE_APPWRITE_SAVES_COLLECTION_ID,
};

export const client = new Client();

client.setProject(appwriteConfig.projectId);
client.setEndpoint(appwriteConfig.url);

export const account = new Account(client);
export const databases = new Databases(client);
export const storage = new Storage(client);
export const avatars = new Avatars(client);

```
</details>

# 后端框架数据测试配置[自定义配置]
# <a href="https://cloud.appwrite.io">后端框架地址</a>

# 第一步注册账号[也可直接github账号登录]
# 第二步创建项目[名称英文，其他随意]
```bash
# 生成的项目ID填入环境中

# 如

# 项目ID
VITE_APPWRITE_PROJECT_ID='随机生成的项目id'

# 后依次创建
# 数据库ID
VITE_APPWRITE_DATABASE_ID='创建完成后的随机数据库id'
# 存储ID
VITE_APPWRITE_STORAGE_ID='创建完成后的存储id'[设置权限与@操作一致]

# 下列集合注意大小写

# 用户集合ID
VITE_APPWRITE_USER_COLLECTION_ID='创建数据集合Users的id'
# 帖子集合ID
VITE_APPWRITE_POST_COLLECTION_ID='创建数据集合Posts的id'
# 保存集合ID
VITE_APPWRITE_SAVES_COLLECTION_ID="创建数据集合Saves的id"
```
# @ 点击数据库后点击users集合的设置[找到权限点击any,全部点上后更新，三个集合依次操作]

# 点击Users集合属性点击创建属性

# 操作1
```text
点击关系 ——> 点击双向关系 ——> 选择Posts集合 ——> Attribute Key值为[posts]:注意大小写 ——> Attribute Key(related collection)值为[creator]
关系选择[多对一]：{Many to one} ————> 删除文档时选择[Set NULL - set document ID as NULL in all related documents]

```

# 操作2
```text
点击关系 ——> 点击双向关系 ——> 选择Posts集合 ——> Attribute Key值为[liked]:注意大小写 ——> Attribute Key(related collection)值为[likes]
关系选择[多对多]：{Many to Many} ————> 删除文档时选择[Set NULL - set document ID as NULL in all related documents]

```

# 操作3
```text
点击关系 ——> 点击双向关系 ——> 选择Saves集合 ——> Attribute Key值为[save]:注意大小写 ——> Attribute Key(related collection)值为[user]
关系选择[多对一]：{Many to one} ————> 删除文档时选择[Set NULL - set document ID as NULL in all related documents]

```
# 添加属性

```text
Attribute Key: name
Size: 2200
```
```text
Attribute Key: username
Size: 2200
```
```text
Attribute Key: bio
Size: 2200 
```
```text
Attribute Key: imageId
Size: 2200
```
```text
选择email
Attribute Key: email
选择必填

Attribute Key:accountId
Size: 2200
选择必填

选择Url
Attribute Key:imageUrl
选择必填

```

# 选择Posts集合添加属性
```text

Attribute Key:caption
Size: 2200

Attribute Key: tags
Size: 2200
选择数组

选择URl
Attribute Key:imageUrl
Size: 2200
选择必填

Attribute Key:imageId
Size: 2200
选择必填

Attribute Key:location
Size: 2200
```
```text
点击关系 ——> 点击双向关系 ——> 选择Saves集合 ——> Attribute Key值为[save]:注意大小写 ——> Attribute Key(related collection)值为[post]
关系选择[多对一]：{Many to one} ————> 删除文档时选择[Set NULL - set document ID as NULL in all related documents]

```

# 前端

# [lib文件夹创建validation文件]

<details>
<summary><code>index.ts</code></summary>

# 输入框验证信息

```ts
import * as z from 'zod'

/*登录*/
export const SigninValidation = z.object({
    email: z.string().email(),
    password: z.string().min(8, { message: "密码至少为八位数." }),
});
```
</details>

# 完善登录组件

<details>
<summary><code>SigninFrom.tsx</code></summary>

```typescript jsx
import { z } from "zod"

import { zodResolver } from "@hookform/resolvers/zod"
import { useForm } from "react-hook-form"
import { Button } from "@/components/ui/button"
import {
    Form,
    FormControl,
    FormField,
    FormItem,
    FormLabel,
    FormMessage,
} from "@/components/ui/form"
import { Input } from "@/components/ui/input"
import {Link} from "react-router-dom";
import {SigninValidation} from "@/lib/validation";

const SigninFrom = () => {

    // 1. Define your form.
    const form = useForm<z.infer<typeof SigninValidation>>({
        resolver: zodResolver(SigninValidation),
        defaultValues: {
            email: "",
            password: "",
        },
    })

    // 2. Define a submit handler.
    const onSubmit = async (values: z.infer<typeof SigninValidation>) => {
        console.log(values)
    }

    return (
        <Form {...form}>
            <div className="sm:w-420 flex-center flex-col">
                <div className="flex justify-between">
                    <img src="/assets/images/logo.svg" alt="logo"/>
                    <div className="flex-center text-white h3-bold text-right">交流平台</div>
                </div>
                <h2 className="h3-bold md:h2-bold pt-5 sm:pt-12">
                    登录你的账户
                </h2>
                <p className="text-light-3 small-medium md:base-regular mt-2">
                    欢迎你，请登录你的账户以继续使用我们的服务。
                </p>
                <form onSubmit={form.handleSubmit(onSubmit)} className="flex flex-col gap-5 w-full mt-4">
                    <FormField
                        control={form.control}
                        name="email"
                        render={({field}) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">邮箱账户</FormLabel>
                                <FormControl>
                                    <Input type="text" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <FormField
                        control={form.control}
                        name="password"
                        render={({ field }) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">密码</FormLabel>
                                <FormControl>
                                    <Input type="password" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    {/*登录按钮*/}
                    <Button type="submit" className="shad-button_primary">
                        登录
                    </Button>

                    {/*转到注册*/}
                    <p className="text-small-regular text-light-2 text-center mt-2">
                        没有&apos;账户？
                        <Link to={"/sign-up"}
                              className="text-primary-500 text-small-semibold ml-1">
                            前往注册
                        </Link>
                    </p>
                </form>
            </div>
        </Form>
    )
}

export default SigninFrom
```
</details>

# 完善注册表单

<details>
<summary>SignupFrom.tsx</summary>

```typescript jsx
import { z } from "zod"

import { zodResolver } from "@hookform/resolvers/zod"
import { useForm } from "react-hook-form"
import { Button } from "@/components/ui/button"
import {
    Form,
    FormControl,
    FormField,
    FormItem,
    FormLabel,
    FormMessage,
} from "@/components/ui/form"
import { Input } from "@/components/ui/input"
import {Link} from "react-router-dom";
import { SignupValidation } from "@/lib/validation";
import Loader from "@/components/shared/Loader.tsx";


const SignupFrom = () => {

   /*注册表单数据*/
    const form = useForm<z.infer<typeof SignupValidation>>({
        resolver: zodResolver(SignupValidation),
        defaultValues: {
            username: "",
            name:"",
            email: "",
            password: "",
        },
    })

    /*注册逻辑*/
    const onSubmit = async (values: z.infer<typeof SignupValidation>) => {
        console.log(values)
    }

    return (
        <Form {...form}>
            <div className="sm:w-420 flex-center flex-col">
                <div className="flex justify-between">
                    <img src="/assets/images/logo.svg" alt="logo"/>
                    <div className="flex-center text-white h3-bold text-right">交流平台</div>
                </div>
                <h2 className="h4-bold md:h2-bold pt-5 sm:pt-12">
                    创建一个账户
                </h2>
                <p className="text-light-3 small-medium md:base-regular mt-2">
                   要使用交流平台，输入你的账户详细信息
                </p>
                <form onSubmit={form.handleSubmit(onSubmit)} className="flex flex-col gap-5 w-full mt-4">
                    <FormField
                        control={form.control}
                        name="name"
                        render={({field}) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">姓名</FormLabel>
                                <FormControl>
                                    <Input type="text" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <FormField
                        control={form.control}
                        name="username"
                        render={({ field }) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">名字</FormLabel>
                                <FormControl>
                                    <Input type="text" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <FormField
                        control={form.control}
                        name="email"
                        render={({ field }) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">账户</FormLabel>
                                <FormControl>
                                    <Input type="text" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    <FormField
                        control={form.control}
                        name="password"
                        render={({ field }) => (
                            <FormItem>
                                <FormLabel className="shad-form_label">密码</FormLabel>
                                <FormControl>
                                    <Input type="password" className="shad-input" {...field} />
                                </FormControl>
                                <FormMessage />
                            </FormItem>
                        )}
                    />
                    {/*注册加载*/}
                    <Button type="submit" className="shad-button_primary">
                        <div className="flex-center gap-2">
                            <Loader /> 加载中...
                        </div>
                        注册
                    </Button>

                    {/*转到登录*/}
                    <p className="text-small-regular text-light-2 text-center mt-2">
                        已有&apos;账户？
                        <Link to={"/sign-in"}
                              className="text-primary-500 text-small-semibold ml-1">
                            前往登录
                        </Link>
                    </p>
                </form>
            </div>
        </Form>
    )
}

export default SignupFrom

```
</details>

# 转到appwrite文件夹

<details>
<summary><code>api.tsx</code></summary>

```typescript jsx
import {account, appwriteConfig, avatars, databases} from "@/lib/appwrite/config.ts";
import {INewUser} from "@/types";
import {ID, Query} from "appwrite";

/*用户登录*/
export async function signInAccount(user: { email: string; password: string }) {
    try {
        /*获取账户密码*/
        return await account.createEmailSession(user.email, user.password);
    } catch (error) {
        console.log(error);
    }
}

/*用户注册*/
export async function createUserAccount(user:INewUser) {
    try {
        /*创建新的账户*/
        const newAccount = await account.create(
            ID.unique(),
            user.email,
            user.password,
            user.name
        )
        if(!newAccount) throw new Error("创建账户错误")

        /*获取用户头像Url*/
        const avatarUrl = avatars.getInitials(user.name)

        /*保存信息到数据库*/
        const newUser = await saveUserToDB({
            accountId: newAccount.$id,
            name: newAccount.name,
            email: newAccount.email,
            username: user.username,
            imageUrl: avatarUrl,
        });

        return newUser

    }catch (error){
        console.error(error)
    }
}

/*保存用户信息到后端数据库*/
export async function saveUserToDB(user:{
    accountId: string;
    email: string;
    name: string;
    imageUrl: URL;
    username?: string;
}){
    try {
        /*创建新的用户信息*/
        const newUser = await databases.createDocument(
            appwriteConfig.databaseId,
            appwriteConfig.userCollectionId,
            ID.unique(),
            user
        );

        return newUser
    }catch (error){
        console.error(error)
    }
}

/*查询用户信息*/
export async function getCurrentUser() {
    try {
        const currentAccount = await getAccount();

        if (!currentAccount) throw Error;

       /*根据ID查找用户信息*/
        const currentUser = await databases.listDocuments(
            appwriteConfig.databaseId,
            appwriteConfig.userCollectionId,
            [Query.equal("accountId", currentAccount.$id)]
        );

        if (!currentUser) throw Error;

        return currentUser.documents[0];
    } catch (error) {
        console.log(error);
        return null;
    }
}

/*获取当前账户信息*/
export async function getAccount() {
    try {
        const currentAccount = await account.get();

        return currentAccount;

    } catch (error) {
        console.log(error);
    }
}

```
</details>

# 转到 react-query

<details>
<summary><code>queries.tsx</code></summary>

```typescript jsx
import {useMutation} from "@tanstack/react-query";
import {createUserAccount, signInAccount} from "@/lib/appwrite/api.ts";
import {INewUser} from "@/types";

/*用户登录*/
export const useSignInAccount = () => {
    return useMutation({
        mutationFn: (user: { email: string; password: string }) =>
            signInAccount(user),
    });
}

/*用户注册*/
export const useCreateUserAccount = () => {
    return useMutation({
        mutationFn: (user: INewUser) => createUserAccount(user),
    });
};

```
</details>

# 验证


<details>
<summary><code>【创建】QueryProvider.tsx</code></summary>

```typescript jsx
/*管理获取和缓存*/
import React from "react";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";
import { QueryClientProvider, QueryClient } from "@tanstack/react-query";

const queryClient = new QueryClient();

export const QueryProvider = ({ children }: { children: React.ReactNode }) => {
    return (
        <QueryClientProvider client={queryClient}>
            {children}
            <ReactQueryDevtools initialIsOpen={false} />
        </QueryClientProvider>
    );
};
```
</details>

# 【创建登录验证文件信息】【context】

# 验证信息

<details>
<summary><code>AuthContext.tsx</code></summary>

```typescript jsx
/*验证*/
import { useNavigate } from "react-router-dom";
import React, { createContext, useContext, useEffect, useState } from "react";

import { IUser } from "@/types";
import { getCurrentUser } from "@/lib/appwrite/api";


// eslint-disable-next-line react-refresh/only-export-components
export const INITIAL_USER = {
    id: "",
    name: "",
    username: "",
    email: "",
    imageUrl: "",
    bio: "",
};

const INITIAL_STATE = {
    user: INITIAL_USER,
    isLoading: false,
    isAuthenticated: false,
    setUser: () => {},
    setIsAuthenticated: () => {},
    checkAuthUser: async () => false as boolean,
};

type IContextType = {
    user: IUser;
    isLoading: boolean;
    setUser: React.Dispatch<React.SetStateAction<IUser>>;
    isAuthenticated: boolean;
    setIsAuthenticated: React.Dispatch<React.SetStateAction<boolean>>;
    checkAuthUser: () => Promise<boolean>;
};

const AuthContext = createContext<IContextType>(INITIAL_STATE);

export function AuthProvider({ children }: { children: React.ReactNode }) {
    const navigate = useNavigate();
    const [user, setUser] = useState<IUser>(INITIAL_USER);
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [isLoading, setIsLoading] = useState(false);

    const checkAuthUser = async () => {
        setIsLoading(true);
        try {
            const currentAccount = await getCurrentUser();
            if (currentAccount) {
                setUser({
                    id: currentAccount.$id,
                    name: currentAccount.name,
                    username: currentAccount.username,
                    email: currentAccount.email,
                    imageUrl: currentAccount.imageUrl,
                    bio: currentAccount.bio,
                });
                setIsAuthenticated(true);

                return true;
            }

            return false;
        } catch (error) {
            console.error(error);
            return false;
        } finally {
            setIsLoading(false);
        }
    };

    useEffect(() => {
        const cookieFallback = localStorage.getItem("cookieFallback");
        if (
            cookieFallback === "[]" ||
            cookieFallback === null ||
            cookieFallback === undefined
        ) {
            navigate("/sign-in");
        }

        checkAuthUser();
    }, [navigate]);

    const value = {
        user,
        setUser,
        isLoading,
        isAuthenticated,
        setIsAuthenticated,
        checkAuthUser,
    };

    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

// eslint-disable-next-line react-refresh/only-export-components
export const useUserContext = () => useContext(AuthContext);

```

</details>

# 合并

<details>
<summary><code>main.tsx</code></summary>

```typescript jsx
import ReactDOM from "react-dom/client";
import App from './App.tsx'
import './globals.css'
import {BrowserRouter} from "react-router-dom";
import {QueryProvider} from "@/lib/react-query/QueryProvider.tsx";
import {AuthProvider} from "@/context/AuthContext.tsx";

ReactDOM.createRoot(document.getElementById('root')!).render(
    <BrowserRouter>
        <QueryProvider>
            <AuthProvider>
                <App/>
            </AuthProvider>
        </QueryProvider>
    </BrowserRouter>
)


```
</details>


# 完成登录注册逻辑

http://localhost:5173/sign-in